+++
title = "Powershell fails as a functional language if commands are in modules."
date = 2011-01-04T09:57:00Z
updated = 2014-05-22T18:58:34Z
tags = ["Powershell", "Functional"]
blogimport = true 
[author]
	name = "Paul Cassidy"
	uri = "https://plus.google.com/112112394037667071918"
+++

<p>I have some functions that contain functions. When I put the Functions in a .ps1 file and Dot Source directly the behave great but if those functions get imported in a module they fail to find the inner function with a CommandNotFound error. It does not matter if the functions are directly in a .psm1 file or if they are dot sourced by the .psm1 file they still fail to find the inner functions. Here are some code examples. Why is this? You can copy the below code into Powershell Console or ISE and run to see the errors.</p>  <pre><span style="color: #0000ff">function</span><span style="color: #000000"> </span><span style="color: #0000ff">TestOuter</span><span style="color: #000000">{<br />       </span><span style="color: #0000ff">param</span><span style="color: #000000">(<br />               [</span><span style="color: #0000ff">string</span><span style="color: #000000">]</span><span style="color: #800080">$Name</span><span style="color: #000000">,</span><span style="color: #000000"><br />               [</span><span style="color: #0000ff">scriptblock</span><span style="color: #000000">]</span><span style="color: #800080">$TestScript</span><span style="color: #000000"><br />       )<br />       </span><span style="color: #0000ff">function</span><span style="color: #000000"> </span><span style="color: #0000cd">TestInner</span><span style="color: #000000">{<br />               </span><span style="color: #0000ff">param</span><span style="color: #000000">(<br />                       [</span><span style="color: #0000ff">int</span><span style="color: #000000">]</span><span style="color: #800080">$Count</span><span style="color: #000000"><br />               )<br />               </span><span style="color: #5f9ea0">Write-Host</span><span style="color: #000000"> </span><span style="color: #800080">$Count</span><span style="color: #000000"><br />       }<br />       </span><span style="color: #5f9ea0">Write-Host</span><span style="color: #000000"> </span><span style="color: #800080">$Name</span><span style="color: #000000"><br />       </span><span style="color: #000000">&amp;</span><span style="color: #000000"> </span><span style="color: #800080">$TestScript</span><span style="color: #000000"><br />}<br /></span><span style="color: #0000ff">TestOuter</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Name</span><span style="color: #000000"> </span><span style="color: #800000">&quot;Paul&quot;</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-TestScript</span><span style="color: #000000"> { </span><span style="color: #0000ff">TestInner</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Count</span><span style="color: #000000"> </span><span style="color: #000000">10</span><span style="color: #000000"> }<br /><br /><br /></span><span style="color: #5f9ea0">New-Module</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Name</span><span style="color: #000000"> </span><span style="color: #800000">'</span><span style="color: #800000">Testing</span><span style="color: #800000">'</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-ScriptBlock</span><span style="color: #000000"> {<br />       </span><span style="color: #0000ff">function</span><span style="color: #000000"> </span><span style="color: #0000cd">TestOuter</span><span style="color: #000000">{<br />               </span><span style="color: #0000ff">param</span><span style="color: #000000">(<br />                       [</span><span style="color: #0000ff">string</span><span style="color: #000000">]</span><span style="color: #800080">$Name</span><span style="color: #000000">,</span><span style="color: #000000"><br />                       [</span><span style="color: #0000ff">scriptblock</span><span style="color: #000000">]</span><span style="color: #800080">$TestScript</span><span style="color: #000000"><br />               )<br />               </span><span style="color: #0000ff">function</span><span style="color: #000000"> </span><span style="color: #0000cd">TestInner</span><span style="color: #000000">{<br />                       </span><span style="color: #0000ff">param</span><span style="color: #000000">(<br />                               [</span><span style="color: #0000ff">int</span><span style="color: #000000">]</span><span style="color: #800080">$Count</span><span style="color: #000000"><br />                       )<br />                       </span><span style="color: #5f9ea0">Write-Host</span><span style="color: #000000"> </span><span style="color: #800080">$Count</span><span style="color: #000000"><br />               }<br />               </span><span style="color: #5f9ea0">Write-Host</span><span style="color: #000000"> </span><span style="color: #800080">$Name</span><span style="color: #000000"><br />               </span><span style="color: #000000">&amp;</span><span style="color: #000000"> </span><span style="color: #800080">$TestScript</span><span style="color: #000000"><br />       }<br />} </span><span style="color: #0000ff">|</span><span style="color: #000000"> </span><span style="color: #5f9ea0">Import-Module</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Force</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Global</span><span style="color: #000000"><br /></span><span style="color: #0000ff">TestOuter</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Name</span><span style="color: #000000"> </span><span style="color: #800000">&quot;Paul&quot;</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-TestScript</span><span style="color: #000000"> { </span><span style="color: #0000ff">TestInner</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Count</span><span style="color: #000000"> </span><span style="color: #000000">10</span><span style="color: #000000"> }<br /></span></pre>  
