+++
title = "Solved: Powershell fails as a functional language if commands are in modules."
date = 2011-01-04T14:13:00Z
updated = 2014-05-22T18:55:12Z
tags = ["Powershell", "Functional"]
blogimport = true 
[author]
	name = "Paul Cassidy"
	uri = "https://plus.google.com/112112394037667071918"
+++

<p>The issue comes down to the scope that the scriptblock being passed into the function gets bound. In the original example the scriptblock was being bound to the callers scope which can not access anything in the module except what was imported into the scope. The fix turns out to be explicitly binding the scriptblock to the modules scope. See the fixed example below. Thanks go out to @Oisin for the fix.</p>  <pre><span style="color: #5f9ea0">New-Module</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Name</span><span style="color: #000000"> </span><span style="color: #800000">'</span><span style="color: #800000">Testing</span><span style="color: #800000">'</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-ScriptBlock</span><span style="color: #000000"> {<br />       </span><span style="color: #0000ff">function</span><span style="color: #000000"> </span><span style="color: #0000cd">TestOuter</span><span style="color: #000000">{<br />               </span><span style="color: #0000ff">param</span><span style="color: #000000">(<br />                       [</span><span style="color: #0000ff">string</span><span style="color: #000000">]</span><span style="color: #800080">$Name</span><span style="color: #000000">,</span><span style="color: #000000"><br />                       [</span><span style="color: #0000ff">scriptblock</span><span style="color: #000000">]</span><span style="color: #800080">$TestScript</span><span style="color: #000000"><br />               )<br />               </span><span style="color: #0000ff">function</span><span style="color: #000000"> </span><span style="color: #0000cd">TestInner</span><span style="color: #000000">{<br />                       </span><span style="color: #0000ff">param</span><span style="color: #000000">(<br />                               [</span><span style="color: #0000ff">int</span><span style="color: #000000">]</span><span style="color: #800080">$Count</span><span style="color: #000000"><br />                       )<br />                       </span><span style="color: #5f9ea0">Write-Host</span><span style="color: #000000"> </span><span style="color: #800080">$Count</span><span style="color: #000000"><br />               }<br />               </span><span style="color: #5f9ea0">Write-Host</span><span style="color: #000000"> </span><span style="color: #800080">$Name</span><span style="color: #000000"><br />               </span><span style="color: #800080">$Mod</span><span style="color: #000000"> </span><span style="color: #ff0000">=</span><span style="color: #000000"> </span><span style="color: #5f9ea0">Get-Module</span><span style="color: #000000"> </span><span style="color: #0000ff">Testing</span><span style="color: #000000"><br />               </span><span style="color: #000000">&amp;</span><span style="color: #000000"> ( </span><span style="color: #800080">$Mod</span><span style="color: #000000">.</span><span style="color: #8b4513">NewBoundScriptBlock</span><span style="color: #000000">(</span><span style="color: #800080">$TestScript</span><span style="color: #000000">) )<br />       }<br />} </span><span style="color: #0000ff">|</span><span style="color: #000000"> </span><span style="color: #5f9ea0">Import-Module</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Force</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Global</span><span style="color: #000000"><br /></span><span style="color: #0000ff">TestOuter</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Name</span><span style="color: #000000"> </span><span style="color: #800000">&quot;Paul&quot;</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-TestScript</span><span style="color: #000000"> { </span><span style="color: #0000ff">TestInner</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Count</span><span style="color: #000000"> </span><span style="color: #000000">10</span><span style="color: #000000"> }<br /></span><span style="color: #5f9ea0">Remove-Module</span><span style="color: #000000"> </span><span style="color: #0000ff">Testing</span><span style="color: #000000"> </span><span style="color: #5f9ea0">-Force</span></pre>  
